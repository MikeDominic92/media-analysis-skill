# BMAD-EDI Archival Guide

## Overview
Documentation Specialist now archives Phase 0 analysis artifacts along with investigation results to build a complete audit trail and knowledge base.

## What Gets Archived

### From Phase 0 (Automated Analysis)
Located in: `processing/[ticket-folder]/`

- **metadata.json** - Pre-extracted metadata from Gemini/OCR
- **preliminary_analysis.md** - Initial analysis report
- **Original ticket file** - PDF, image, audio, or video file

### From Investigation (Manual Analysis)
Located in: `investigation/[ticket-folder]/` (conceptual - actual location varies)

- **investigation_report.md** - Complete investigation PRD with findings
- **notebooklm_citations.md** - Knowledge base sources and citations
- **Customer response drafts** - Technical and customer-friendly versions

### Generated During Archival
Created by archival.py:

- **resolution_summary.md** - Complete timeline, metrics, and quality data
- **phase0_metrics.json** - Phase 0 performance tracking for continuous improvement

## Why Archive Phase 0 Data?

### 1. Audit Trail
- Track extraction accuracy over time
- Document confidence scores and methods used
- Verify automated analysis quality
- Compliance and quality assurance

### 2. Knowledge Base Growth
- Build dataset for future training
- Identify patterns in ticket types
- Improve extraction algorithms
- Benchmark automation effectiveness

### 3. Quality Metrics
- Monitor automation success rate
- Track time savings from Phase 0
- Identify failure modes
- Continuous improvement data

### 4. Debugging & Troubleshooting
- Diagnose extraction failures
- Compare Gemini vs OCR performance
- Identify problematic file types
- Root cause analysis for errors

## Usage

### Command Line Interface

```bash
python archival.py <ticket_id> <webedi_id> <company_name>
```

### Example

```bash
python archival.py 13624970 WEB-456 "Ace Hardware"
```

### Parameters

- **ticket_id**: Original ticket ID from processing folder (e.g., 13624970)
- **webedi_id**: WebEDI internal customer ID (e.g., WEB-456)
- **company_name**: Customer company name (e.g., "Ace Hardware")

### Integration with Documentation Specialist

The archival script is called automatically during Phase 7 (File Organization & Archiving) of the BMAD-EDI workflow.

```python
# Within Documentation Specialist workflow
from archival import ResolutionArchiver

archiver = ResolutionArchiver(ticket_id)
resolution_path = archiver.archive_resolution(webedi_id, company_name)
```

## Resolution Folder Structure

```
resolution/
└── [WebEDI-ID]_[Company_Name]/
    ├── ticket_original/
    │   ├── [original_filename].pdf
    │   └── metadata.json (Phase 0 output)
    │
    ├── analysis/
    │   ├── preliminary_analysis.md (Phase 0 output)
    │   ├── investigation_report.md (Phase 3-5 output)
    │   └── notebooklm_citations.md (Phase 5 output)
    │
    ├── customer_response/
    │   ├── response_draft.md
    │   └── response_final.md
    │
    ├── verification/
    │   ├── qa_checklist.md (Phase 8 output)
    │   └── sign_off.md (Phase 8 output)
    │
    ├── resolution_summary.md (Generated by archival.py)
    └── phase0_metrics.json (Generated by archival.py)
```

## Resolution Summary Template

The `resolution_summary.md` file provides a complete overview:

```markdown
# Resolution Summary - Ticket [ID]

## Timeline
- **Received:** [timestamp]
- **Phase 0 Complete:** [timestamp] (+2 minutes)
- **Investigation Complete:** [timestamp]
- **Resolution Delivered:** [timestamp]
- **Total Time:** [duration]

## Phase 0 Analysis Results
- **Extraction Method:** Gemini 2.5 Pro
- **Confidence Score:** 0.92 (HIGH)
- **Accuracy:** 100% (verified by Analyst)
- **Time Saved:** 3 minutes (vs manual extraction)

## Investigation Results
- **NotebookLM Queries:** 4
- **Knowledge Base Sources:** 7
- **Root Cause:** [summary]
- **Solution:** [summary]

## Customer Impact
- **Severity:** HIGH
- **Resolution Time:** 45 minutes
- **Customer Satisfaction:** 5/5 (if available)

## Quality Metrics
- **Extraction Accuracy:** 100%
- **NotebookLM Confidence:** 0.95
- **Solution Verified:** Yes
- **QA Sign-Off:** Yes
```

## Phase 0 Metrics Tracking

The `phase0_metrics.json` file tracks performance for continuous improvement:

```json
{
  "ticket_id": "13624970",
  "phase0_timestamp": "2025-10-29T14:30:00Z",
  "extraction_method": "gemini",
  "confidence_score": 0.92,
  "processing_time_seconds": 45,
  "file_type": "pdf",
  "file_size_mb": 2.3,
  "metadata_fields_extracted": 12,
  "metadata_fields_verified": 12,
  "accuracy_percentage": 100,
  "ocr_fallback_used": false,
  "errors": [],
  "archived_at": "2025-10-29T14:45:00Z"
}
```

## Benefits

### 1. Complete Audit Trail
- Track extraction accuracy over time
- Document automated analysis performance
- Verify quality standards maintained
- Regulatory compliance (if applicable)

### 2. Knowledge Base Growth
- Build training dataset from real tickets
- Identify recurring patterns
- Improve extraction algorithms
- Share insights across team

### 3. Quality Metrics Dashboard
- Monitor automation effectiveness
- Track time savings from Phase 0
- Identify improvement opportunities
- Benchmark against manual extraction

### 4. Continuous Improvement
- Analyze failure modes
- Compare Gemini vs OCR performance
- Optimize confidence thresholds
- Refine extraction prompts

## Example Workflow

### Complete Ticket Resolution with Archival

```python
# Phase 0: Media Analysis (Automatic)
# - Gemini extracts metadata
# - Saves to processing/13624970/metadata.json

# Phase 1-5: Investigation (Agent-based)
# - Analyst extracts info
# - PM-Investigator creates plan
# - Investigator queries NotebookLM
# - Documentation Specialist drafts response

# Phase 7: Archival (Documentation Specialist)
from archival import ResolutionArchiver

archiver = ResolutionArchiver("13624970")
resolution_path = archiver.archive_resolution("WEB-456", "Ace Hardware")

# Output:
# [*] Archiving to: C:\Users\sleep\Documents\tickets\resolution\WEB-456_Ace_Hardware
# [+] Copied metadata.json
# [+] Copied preliminary_analysis.md
# [+] Copied 2025-10-29_13624970_AceHardware.pdf
# [+] Generated resolution_summary.md
# [+] Generated phase0_metrics.json
# [+] Archive complete: C:\Users\sleep\Documents\tickets\resolution\WEB-456_Ace_Hardware
```

## Troubleshooting

### Issue: Phase 0 artifacts not found

**Cause:** processing/[ticket-id]/ folder doesn't exist

**Solution:**
- Verify ticket went through Phase 0 media analysis
- Check if media-analysis hooks are active
- Manually create Phase 0 artifacts if needed
- Script will warn but continue archival

### Issue: Metadata.json missing fields

**Cause:** Phase 0 extraction incomplete

**Solution:**
- Review Phase 0 confidence score
- Check Gemini extraction log
- Verify OCR fallback occurred if needed
- Update metrics with actual accuracy

### Issue: File type not detected

**Cause:** Unknown file extension

**Solution:**
- Add file extension to archival.py (_generate_phase0_metrics)
- Update supported file types list
- Default to "unknown" type (safe fallback)

## Performance Metrics

### Time Savings
- **Manual extraction:** ~5 minutes per ticket
- **Automated Phase 0:** ~45 seconds
- **Time saved:** ~4 minutes per ticket
- **Annual savings (10 tickets/day):** ~160 hours/year

### Quality Metrics
- **Extraction accuracy:** 95%+ (Gemini)
- **Confidence threshold:** 0.85 for high confidence
- **OCR fallback rate:** <5% of tickets
- **Error rate:** <1% requiring manual intervention

## Future Enhancements

### Planned Features
1. **Aggregate Metrics Dashboard** - View all Phase 0 performance data
2. **Accuracy Reporting** - Compare Phase 0 vs Analyst extraction
3. **Pattern Detection** - Identify common ticket types automatically
4. **Knowledge Base Integration** - Feed patterns to NotebookLM
5. **Automated Insights** - Surface improvement opportunities

### Integration Opportunities
1. **Memory MCP** - Store patterns in knowledge graph
2. **Serena MCP** - Track session context across tickets
3. **Sequential Thinking MCP** - Structured pattern analysis
4. **Filesystem MCP** - Automated KB file management

## Summary

The archival system ensures every ticket builds organizational knowledge by:
- Preserving complete extraction and investigation history
- Tracking automation effectiveness metrics
- Building training datasets for continuous improvement
- Enabling pattern recognition across customer base
- Supporting compliance and quality assurance

**Documentation Specialist agents should always use archival.py during Phase 7 file organization.**
